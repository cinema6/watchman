{
    "name": "development",
    "chef_type": "environment",
    "json_class": "Chef::Environment",
    "description": "Watchman Development Environment",
    "default_attributes": {
        "watchman" : {
            "rsyslog": {
                "monitor": "true",
                "watchman": {
                    "token": "fac240ab-aa03-4430-8966-a474b92773d3"
                },
                "devTimeStreamApplication": {
                    "token": "64ae1c2d-3425-4337-841f-df86e3362ebb"
                },
                "devWatchmanStreamApplication": {
                    "token": "e488a8de-462d-4f59-ad68-f7cf2f268c3d"
                },
                "devCwrxStreamApplication": {
                    "token": "86527b56-b848-4c65-b274-33e09cf2a9eb"
                }
            },
            "deploy": {
                "apps": ["devTimeStreamApplication", "devWatchmanStreamApplication", "devCwrxStreamApplication"]
            },
            "app": {
                "config": {
                    "log": {
                        "logLevel": "trace",
                        "logDir": "/opt/sixxy/logs",
                        "logName": "watchman.log",
                        "media": [ { "type": "file" } ]
                    },
                    "secrets": "/opt/sixxy/.watchman.secrets.json",
                    "appCreds": "/opt/sixxy/.rcAppCreds.json",
                    "cwrx": {
                        "api": {
                            "root": "http://33.33.33.10",
                            "auth": {
                                "endpoint": "/api/auth"
                            },
                            "campaigns": {
                                "endpoint": "/api/campaigns"
                            },
                            "analytics": {
                                "endpoint": "/api/analytics"
                            },
                            "users": {
                                "endpoint": "/api/account/users"
                            },
                            "orgs": {
                                "endpoint": "/api/account/orgs"
                            },
                            "payments": {
                                "endpoint": "/api/payments/"
                            },
                            "promotions": {
                                "endpoint": "/api/promotions"
                            },
                            "transactions": {
                                "endpoint": "/api/transactions"
                            },
                            "accounting": {
                                "endpoint": "/api/accounting"
                            },
                            "placements": {
                                "endpoint": "/api/placements"
                            },
                            "advertisers": {
                                "endpoint": "/api/account/advertisers"
                            }
                        }
                    },
                    "pidPath": "/opt/sixxy/run",
                    "cloudWatch": {
                        "namespace": "C6/Watchman",
                        "region": "us-east-1",
                        "dimensions": [
                            {
                                "Name": "Environment",
                                "Value": "Development"
                            }
                        ],
                        "sendInterval": 60000
                    },
                    "emails": {
                        "sender": "support@cinema6.com",
                        "dashboardLinks": {
                            "selfie": "http://localhost:9000/#/apps/selfie/campaigns",
                            "showcase": "http://localhost:9000/#/showcase/products"
                        },
                        "manageLink": "http://localhost:9000/#/apps/selfie/campaigns/manage/:campId/manage",
                        "reviewLink": "http://localhost:9000/#/apps/selfie/campaigns/manage/:campId/admin",
                        "activationTargets": {
                            "selfie": "http://localhost:9000/#/confirm?selfie=selfie",
                            "showcase": "http://localhost:9000/#/showcase/confirm"
                        },
                        "supportAddress": "c6e2etester@gmail.com",
                        "passwordResetPages": {
                            "portal": "http://localhost:9000/#/password/forgot",
                            "selfie": "http://localhost:9000/#/pass/forgot?selfie=true",
                            "showcase": "http://localhost:9000/#/showcase/pass/forgot"
                        },
                        "forgotTargets": {
                            "portal": "http://localhost:9000/#/password/reset",
                            "selfie": "http://localhost:9000/#/pass/reset?selfie=true",
                            "showcase": "http://localhost:9000/#/showcase/pass/reset"
                        },
                        "previewLink": "https://reelcontent.com/preview/?previewSource=platform&campaign=:campId",
                        "beeswax": {
                            "campaignLink": "http://stingersbx.beeswax.com/advertisers/{{advertiserId}}/campaigns/{{campaignId}}/line_items"
                        }
                    },
                    "paymentPlans": {
                        "pp-0Ek5Na02vCohpPgw": {
                            "id": "pp-0Ek5Na02vCohpPgw",
                            "price": 49.99,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        },
                        "pp-0Ek2xF0332Eh3-FY": {
                            "id": "pp-0Ek2xF0332Eh3-FY",
                            "price": 39.99,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        },
                        "pp-0Ek2zH0332VnSBqZ": {
                            "id": "pp-0Ek2zH0332VnSBqZ",
                            "price": 29.99,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        },
                        "pp-0Ek2HA0334w6CXbl": {
                            "id": "pp-0Ek2HA0334w6CXbl",
                            "price": 19.99,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        },
                        "pp-0Ek2Ik0334Dio8u_": {
                            "id": "pp-0Ek2Ik0334Dio8u_",
                            "price": 9.99,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        },
                        "pp-0EkadV034j3RVWIw": {
                            "id": "pp-0EkadV034j3RVWIw",
                            "price": 2499,
                            "impressionsPerDollar": 50,
                            "dailyImpressionLimit": 100
                        }
                    },
                    "promotions": [
                        {
                            "type": "signupReward",
                            "fulfillImmediately": true
                        },
                        {
                            "type": "freeTrial",
                            "fulfillImmediately": false
                        }
                    ],
                    "postmark": {
                        "templates": {
                            "campaignExpired": "672685",
                            "campaignOutOfBudget": "672705",
                            "campaignApproved": "672706",
                            "campaignUpdateApproved": "672707",
                            "campaignRejected": "672781",
                            "campaignUpdateRejected": "672782",
                            "newUpdateRequest": "672784",
                            "paymentReceipt": "672801",
                            "paymentReceipt--app": "672786",
                            "activateAccount": "672787",
                            "activateAccount--app": "672803",
                            "accountWasActivated": "672804",
                            "accountWasActivated--app": "672805",
                            "passwordChanged": "672788",
                            "passwordChanged--app": "672806",
                            "emailChanged": "672807",
                            "emailChanged--app": "672901",
                            "failedLogins": "672903",
                            "failedLogins--app": "672904",
                            "passwordReset": "672905",
                            "passwordReset--app": "672906",
                            "chargePaymentPlanFailure": "672809",
                            "campaignActive": "672909",
                            "campaignSubmitted": "672810",
                            "initializedShowcaseCampaign": "672910",
                            "campaignActive--app": "694541",
                            "promotionEnded--app": "722104"
                        }
                    }
                }
            },
            "devTimeStreamApplication": {
                "config": {
                    "kinesis": {
                        "consumer": {
                            "processor": "TimeEventProcessor.js",
                            "appName": "devTimeStreamApplication"
                        },
                        "producer": {
                            "region": "us-east-1"
                        }
                    },
                    "eventHandlers": {
                        "tenMinutes": {
                            "actions": [
                                {
                                    "name": "fetch_campaigns",
                                    "options": {
                                        "statuses": ["active", "paused", "outOfBudget"],
                                        "prefix": "hourly",
                                        "analytics": true,
                                        "number": 50
                                    }
                                },
                                {
                                    "name": "check_available_funds"
                                }
                            ]
                        },
                        "hourly": {
                            "actions": [
                                {
                                    "name": "fetch_orgs",
                                    "options": {
                                        "prefix": "morning"
                                    },
                                    "ifData": {
                                        "hour": "^4$"
                                    }
                                },
                                {
                                    "name": "fetch_orgs",
                                    "options": {
                                        "prefix": "noon"
                                    },
                                    "ifData": {
                                        "hour": "^12$"
                                    }
                                }
                            ]
                        }
                    }
                }
            },
            "devWatchmanStreamApplication": {
                "config": {
                    "kinesis": {
                        "consumer": {
                            "processor": "WatchmanEventProcessor.js",
                            "appName": "devWatchmanStreamApplication"
                        },
                        "producer": {
                            "region": "us-east-1"
                        }
                    },
                    "eventHandlers": {
                        "morning_orgPulse": {
                            "actions": [
                                {
                                    "name": "check_payment_plan_start"
                                }
                            ]
                        },
                        "noon_orgPulse": {
                            "actions": ["check_payment_required"]
                        },
                        "hourly_campaignPulse": {
                            "actions": ["check_expiry"]
                        },
                        "paymentPlanWillStart": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "promotionEnded"
                                    }
                                }
                            ]
                        },
                        "campaignOutOfFunds": {
                            "actions": [
                                {
                                    "name": "message/log",
                                    "options": {
                                        "text": "[activity] Campaign {{campaign.name}} ({{campaign.id}}) is out of funds",
                                        "level": "warn"
                                    }
                                }
                            ]
                        },
                        "campaignExpired": {
                            "actions": [
                                {
                                    "name": "set_status",
                                    "options": {
                                        "status": "expired"
                                    }
                                }
                            ]
                        },
                        "campaignReachedBudget": {
                            "actions": [
                                {
                                    "name": "set_status",
                                    "options": {
                                        "status": "outOfBudget"
                                    }
                                }
                            ]
                        },
                        "paymentRequired": {
                            "actions": [
                                {
                                    "name": "charge_payment_plan",
                                    "options": {
                                        "target": "showcase"
                                    }
                                }
                            ]
                        },
                        "chargePaymentPlanFailure": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "chargePaymentPlanFailure"
                                    }
                                }
                            ]
                        },
                        "promotionFulfilled": {
                            "actions": [
                                {
                                    "name": "create_promotion_credit"
                                }
                            ]
                        },
                        "initializedShowcaseCampaign": {
                            "actions": [
                                {
                                    "name": "activate_payment_plan",
                                    "options": {
                                        "target": "showcase"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignActive"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "initializedShowcaseCampaign",
                                        "toSupport": true
                                    }
                                },
                                {
                                    "name": "hubspot/update_user",
                                    "options": {
                                        "properties": {
                                            "applications": "apps",
                                            "lifecyclestage": "customer"
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            },
            "devCwrxStreamApplication": {
                "config": {
                    "kinesis": {
                        "consumer": {
                            "processor": "CwrxEventProcessor.js",
                            "appName": "devCwrxStreamApplication"
                        },
                        "producer": {
                            "region": "us-east-1"
                        }
                    },
                    "eventHandlers": {
                        "campaignStateChange": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignExpired"
                                    },
                                    "ifData": {
                                        "previousState": "active|paused",
                                        "currentState": "expired",
                                        "campaign.application": "^(studio|selfie)$"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignReachedBudget"
                                    },
                                    "ifData": {
                                        "currentState": "outOfBudget",
                                        "campaign.application": "^(studio|selfie)$"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignActive"
                                    },
                                    "ifData": {
                                        "previousState": "pending",
                                        "currentState": "active",
                                        "campaign.application": "^(studio|selfie)$"
                                    }
                                }
                            ]
                        },
                        "campaignCreated": {
                            "actions": [
                                {
                                    "name": "showcase/apps/init_campaign",
                                    "ifData": {
                                        "campaign.application": "^showcase$",
                                        "campaign.product.type": "^app$"
                                    },
                                    "options": {
                                        "card": {
                                            "interstitial": {
                                                "cardType": "showcase-app"
                                            },
                                            "threeHundredByTwoFifty": {
                                                "cardType": "showcase-app"
                                            }
                                        },
                                        "placement": {
                                            "interstitial": {
                                                "tagType": "mraid",
                                                "tagParams": {
                                                    "container": { "value": "beeswax" },
                                                    "type": { "value": "mobile-card" },
                                                    "branding": { "value": "showcase-app--interstitial" },
                                                    "hostApp": { "value": "{{APP_BUNDLE}}", "inTag": true },
                                                    "network": { "value": "{{INVENTORY_SOURCE}}", "inTag": true },
                                                    "uuid": { "value": "{{IOS_ID}}", "inTag": true },
                                                    "clickUrls": { "value": ["{{CLICK_URL}}"], "inTag": true },
                                                    "forceOrientation": { "value": "none" }
                                                }
                                            },
                                            "threeHundredByTwoFifty": {
                                                "tagType": "display",
                                                "tagParams": {
                                                    "container": { "value": "beeswax" },
                                                    "type": { "value": "mobile-card" },
                                                    "branding": { "value": "showcase-app--300x250" }
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        },
                        "campaignUpdateApproved": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignUpdateApproved"
                                    }
                                }
                            ]
                        },
                        "campaignRejected": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignRejected"
                                    }
                                }
                            ]
                        },
                        "campaignUpdateRejected": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignUpdateRejected"
                                    }
                                }
                            ]
                        },
                        "newUpdateRequest": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "toSupport": true,
                                        "type": "newUpdateRequest"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "campaignSubmitted"
                                    },
                                    "ifData": {
                                        "updateRequest.initialSubmit": true
                                    }
                                }
                            ]
                        },
                        "paymentMade": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "paymentMade"
                                    }
                                }
                            ]
                        },
                        "transactionCreated": {
                            "actions": [
                                {
                                    "name": "showcase/apps/auto_increase_budget",
                                    "options": {
                                        "dailyLimit": 2,
                                        "externalAllocationFactor": 0.5
                                    },
                                    "ifData": {
                                        "transaction.sign": "^1$",
                                        "transaction.description": "\"target\"\\s*:\\s*\"showcase\""
                                    }
                                }
                            ]
                        },
                        "accountCreated": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "activateAccount"
                                    }
                                },
                                {
                                    "name": "hubspot/submit_form",
                                    "options": {
                                        "portal": "2041560",
                                        "form": "73472e84-6426-4fab-b092-936c0f692da6",
                                        "data": {
                                            "applications": "apps"
                                        }
                                    },
                                    "ifData": {
                                        "target": "^showcase$"
                                    }
                                },
                                {
                                    "name": "hubspot/update_user",
                                    "options": {
                                        "properties": {
                                            "applications": "apps",
                                            "lifecyclestage": "salesqualifiedlead"
                                        }
                                    },
                                    "ifData": {
                                        "target": "^showcase$"
                                    }
                                }
                            ]
                        },
                        "accountActivated": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "accountWasActivated"
                                    }
                                },
                                {
                                    "name": "check_signup_promotion"
                                },
                                {
                                    "name": "hubspot/update_user",
                                    "options": {
                                        "properties": {
                                            "applications": "apps",
                                            "lifecyclestage": "opportunity"
                                        }
                                    },
                                    "ifData": {
                                        "target": "^showcase$"
                                    }
                                }
                            ]
                        },
                        "passwordChanged": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "passwordChanged"
                                    }
                                }
                            ]
                        },
                        "emailChanged": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "emailChanged",
                                        "to": "{{oldEmail}}"
                                    }
                                },
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "emailChanged",
                                        "to": "{{newEmail}}"
                                    }
                                },
                                {
                                    "name": "hubspot/update_user",
                                    "ifData": {
                                        "target": "^showcase$"
                                    }
                                }
                            ]
                        },
                        "failedLogins": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "failedLogins"
                                    }
                                }
                            ]
                        },
                        "forgotPassword": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "forgotPassword"
                                    }
                                }
                            ]
                        },
                        "resendActivation": {
                            "actions": [
                                {
                                    "name": "message/campaign_email",
                                    "options": {
                                        "type": "activateAccount"
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    }
}
